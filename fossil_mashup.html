<!DOCTYPE html>
<html>
<head>
	<title>Fossil Mashup</title>
	<script>
        function isset(x){
            return !(typeof x === "undefined");
        }

        function getForm(f) {
            var x, ass = {h: 0, t: 1, x: 2};
            x = document.getElementById("myForm").elements[ass[f]].value;
            return x;
        }
        
        function randInt(a, b){
            var min, max;
            if(a > b) {
            	min = b;
                max = a;
            } else {
            	min = a;
                max = b;
            }
            return Math.floor(Math.random() * (+max - +min)) + +min;
        }
        
        //here I declare the fossil characteristics (name, number of letters in the tail part, type, primary ability, secondary ability - if present - and hidden ability, then the stat boost values for each stat, and finally the Attack of the original Pok√©mon - to determine which one is the offensive among the fusees).
        var omastar = 		new Array("Omastar",	3, "Water", 	"Swift Swim", 	"Shell Armor", 	"Weak Armor", 	3, 2, 6, 5, 3, 1, 60),
            kabutops = 		new Array("Kabutops", 	4, "Water", 	"Swift Swim", 	"Battle Armor", "Weak Armor", 	1, 6, 5, 2, 3, 4, 115),
            aerodactyl = 	new Array("Aerodactyl", 4, "Flying", 	"Rock Head", 	"Pressure", 	"Unnerve", 		4, 5, 1, 2, 3, 6, 105),
            cradily = 		new Array("Cradily", 	3, "Grass", 	"Suction Cups", "", 			"Storm Drain", 	4, 2, 5, 2, 6, 1, 81),
            armaldo = 		new Array("Armaldo", 	4, "Bug", 		"Battle Armor", "", 			"Swift Swim", 	3, 6, 5, 2, 4, 1, 125),
            rampardos = 	new Array("Rampardos", 	5, "Rock", 		"Mold Breaker", "", 			"Sheer Force", 	5, 6, 3, 4, 1, 2, 165),
            bastiodon = 	new Array("Bastiodon", 	6, "Steel", 	"Sturdy", 		"", 			"Soundproof", 	4, 3, 6, 2, 5, 1, 52),
            carracosta =	new Array("Carracosta", 5, "Water", 	"Solid Rock", 	"Sturdy", 		"Swift Swim", 	3, 6, 5, 4, 2, 1, 108),
            archeops = 		new Array("Archeops", 	5, "Flying", 	"Defeatist", 	"", 			"Defeatist", 	3, 6, 1, 5, 1, 4, 140),
            tyrantrum = 	new Array("Tyrantrum", 	4, "Dragon", 	"Strong Jaw", 	"", 			"Rock Head", 	4, 6, 5, 2, 1, 3, 121),
            aurorus = 		new Array("Aurorus", 	4, "Ice", 		"Refrigerate", 	"", 			"Snow Warning", 6, 3, 2, 5, 4, 1, 77),
            row = new Array(omastar, kabutops, aerodactyl, cradily, armaldo, rampardos, bastiodon, carracosta, archeops, tyrantrum, aurorus); 
     </script>
</head>
<body>
    <font face='Arial'>
    <p><h2>Select the Fusees</h2></p>
    <table>
        <tr>
            <td>Fusees:</td>
            <td><table><tr><td><select name="h" id="head" width=120>
            <option value=""> -- Head -- </option>
            <script>for(var i = 0; i < row.length; i++){ 
				document.write("<option value=" + i + ">" + row[i][0] + "</option>"); 
			} </script></select>
            </td><td><select name="t" id="tail" width=120>
            <option value=""> -- Tail -- </option>
            <script>for(var i = 0; i < row.length; i++){ 
				document.write("<option value=" + i + ">" + row[i][0] + "</option>"); 
			} </script></select></td></tr></table></td>
        </tr>
        <tr>
            <td><select name="x" id="x">
				<option value=5> Stat Coefficient of 5</option>
				<option value=10> Stat Coefficient of 10 </option>
            </select></td>
			<td><table><tr><td><button onclick="fillTable()">Generate</button></td>
			<td><button onclick="swap()">Swap</button></td>
			<td><button onclick="randomize()">Randomize</button></td></tr></table></td>
        </tr>
    </table>
    <table border=2>
        <tr>
            <td><table border=1>
                <tr>
                    <td width=60> 
                        <p>Name:</p>
                        <p>Head:</p>
                        <p>Tail:</p>
                        <p>Type:</p>
                        <p>Ability1:</p>
                        <p>Ability2:</p>
                        <p>HAbility:</p> 
                    </td>
                    <td width=100><p id="traits_fusion">Fusion Traits</p></td>
                    <td><p id="sprite_fusee_1">Sprite Fusee 1</p></td>
                </tr><tr>
                    <td><table border=1>
                      <tr><td width=60>HP</td></tr>
                      <tr><td width=60>ATK</td></tr>
                      <tr><td width=60>DEF</td></tr>
                      <tr><td width=60>SPA</td></tr>
                      <tr><td width=60>SPD</td></tr>
                      <tr><td width=60>SPE</td></tr>
                      <tr><td width=60>BST</td></tr>
                    </table></td>
                    <td><p id="stat_fusion">Fusion Stats</p></td>
                    <td><p id="sprite_fusee_2">Sprite Fusee 2</p></td>
                </tr>
            </table></td>
        </tr>
    </table></font>
    <script>
    // Up there, where 'id = ' appears, should be written the characteristics of the fusions, that are filled down here.
    function fillTable() {
        var head, tail, h, t, name, val, bst, most, x, y;

        h = document.getElementById("head").value;
        t = document.getElementById("tail").value;
        x = document.getElementById("x").value;
        if(h != '' && t != ''){
            head = row[h];
            tail = row[t];

            // here the name is determined (you can see how the second entry is used), and then I try to fill the table.
            var buffer1 = "";
            name  = tail[0].substr(0, tail[1]) + head[0].substr(head[1], head[0].length - 1);
            buffer1 += "<p>" + name + "</p> <p>" + head[0] + "</p> <p>" + tail[0] + "</p>";
            buffer1 += "<p><input type='image' src='https://play.pokemonshowdown.com/sprites/types/" + head[2] + ".png'>";
            if(head[2].localeCompare(tail[2]) != 0) {
                buffer1 += "<input type='image' src='https://play.pokemonshowdown.com/sprites/types/" + tail[2] + ".png'>";
            }
            buffer1 += "</p>";

            // abilities are determined now, you can see the if-then-else mechanism behind secondary ability determination.
            var primary, hidden, secondary;
            primary = head[3];
            hidden = (tail[5] != primary) ? (tail[5]) : (tail[3]);
            if(head[3] == head[5] || tail[3] == tail[5]) secondary = '---';
            else if(head[4] != "" && head[4] != primary && head[4] != hidden) secondary = head[4];
            else if(tail[4] != "" && tail[4] != primary && tail[4] != hidden) secondary = tail[4];
            else if(tail[3] != primary && tail[3] != hidden) secondary = tail[3];
            else secondary = '---';
            buffer1 += "<p>" + primary + "</p> <p>" + secondary + "</p> <p>" + hidden + "</p>";
            document.getElementById("traits_fusion").innerHTML = buffer1;
            document.getElementById("sprite_fusee_1").innerHTML = "<input type='image' src='https://play.pokemonshowdown.com/sprites/dex/" + head[0].toLowerCase() + ".png'>";

            // here the stats are determined: first is determined the stat multiplier and the amount to be added to each stat, 
            // then each stat with the formula described above, then the correction to fit the 505 BST is applied; 
            // after that the stats are inverted in the case head's Attack is higher than tail's.
            // then each stat should be printed inside the string buffer 2 and then shown in the website.
            buffer2 = "<table border=1>";
            bst = 0;
            most = [-1, 255];
            y = (510 - 42 * x) / 6;
            val = [0, 0, 0, 0, 0, 0];
            if(h != t){
                for(var i = 0; i < 6; i++){
                    val[i] = ((head[6 + i] + tail[6 + i]) * x + y);
                    bst += val[i];
                    if(val[i] < most[1]){
                        most[0] = i;
                        most[1] = val[i];
                    }
                }

                if(bst == 510){
                    val[most[0]] -= 5;
                    bst -= 5;
                } else if(bst == 500){
                    val[most[0]] += 5;
                    bst += 5;
                }
                if(head[12] > tail[12]){
                    tmp = val[1];
                    val[1] = val[2];
                    val[2] = tmp;
                    tmp = val[3];
                    val[3] = val[4];
                    val[4] = tmp;
                }
            } else {
                for(var i = 0; i < 6; i++){
                    val[i] = head[6 + i] * x;
                    bst += val[i];
                }
                bst = bst * 2 + 300;
            }
            for(stat of val){
                buffer2 += '<tr><td width=120>' + stat + '</td></tr>';  
            }
            buffer2 += '<tr><td width=110>' + bst + '</td></tr></table>';
            document.getElementById("stat_fusion").innerHTML = buffer2;
            document.getElementById("sprite_fusee_2").innerHTML = '<input type="image" src="https://play.pokemonshowdown.com/sprites/dex/' + tail[0].toLowerCase() + '.png">';
        } else alert("Select head and tail.");
    }
    
    function swap(){
    	var tmp = document.getElementById("head").value;
        document.getElementById("head").value = document.getElementById("tail").value;
        document.getElementById("tail").value = tmp;
        fillTable();
    }
    
    function randomize() {
    	var hr = randInt(0, 10);
        var tr = randInt(0, 10);
        if(hr == tr) tr++;
    	document.getElementById("head").value = hr;
        document.getElementById("tail").value = tr;
        fillTable();
    }
    </script>
</body>
</html>